<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLE523 Instance Identifier</title>
    <!-- Tailwind CSS for clean, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .card { 
            box-shadow: 0 10px 25px rgba(44, 62, 80, 0.15); 
            border-top: 6px solid #3498db;
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">
    <div id="status-card" class="card bg-white p-8 rounded-xl max-w-lg w-full text-center transition-shadow duration-300">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-4">✅ ALB ROUTING SUCCESSFUL ✅</h1>
        <p class="text-lg text-gray-600 mb-6">You are successfully viewing content from a backend EC2 instance.</p>
        
        <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
            <h2 class="text-xl font-semibold text-blue-700 mb-3">Backend Server Private IP Address:</h2>
            <p id="ip-address" class="text-4xl font-mono text-blue-900 break-all bg-white p-2 rounded shadow-inner">
                ... Fetching IP ...
            </p>
        </div>
        
        <ul class="mt-6 text-sm text-gray-500 list-disc list-inside space-y-1">
             <li>This IP will change between reloads due to the Application Load Balancer.</li>
             <li>Assignment: CLE 523 Month 3 Automation</li>
        </ul>
    </div>

    <script>
        // CRITICAL FUNCTION: Fetches the instance's private IP from the AWS metadata service.
        function getPrivateIp() {
            // The magic IP 169.254.169.254 is only accessible from the EC2 instance itself.
            fetch('http://169.254.169.254/latest/meta-data/local-ipv4')
                .then(response => {
                    // Check if the request was successful
                    if (!response.ok) {
                        throw new Error('Could not fetch AWS metadata. Service likely blocked.');
                    }
                    return response.text();
                })
                .then(ip => {
                    // Display the fetched IP
                    document.getElementById('ip-address').textContent = ip;
                    console.log("Successfully retrieved server IP:", ip);
                })
                .catch(error => {
                    // Fallback message if the service cannot be reached
                    console.error("Error during IP fetch:", error);
                    document.getElementById('ip-address').textContent = '127.0.0.1 (IP Fetch Failed)';
                });
        }
        
        // Execute the function when the page loads
        window.onload = getPrivateIp;
    </script>
</body>
</html>